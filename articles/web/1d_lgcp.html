<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LGCPs - An example in one dimension • inlabru</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="LGCPs - An example in one dimension">
<meta property="og:description" content="inlabru">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">inlabru</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.2.8.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/linearapprox.html">Nonlinear model approximation</a>
    </li>
    <li>
      <a href="../../articles/method.html">Iterative INLA method</a>
    </li>
    <li>
      <a href="../../articles/web/1d_lgcp.html">LGCPs - An example in one dimension</a>
    </li>
    <li>
      <a href="../../articles/web/2d_lgcp.html">LGCPs - An example in two dimensions</a>
    </li>
    <li>
      <a href="../../articles/web/2d_lgcp_covars.html">LGCPs - Spatial covariates</a>
    </li>
    <li>
      <a href="../../articles/web/2d_lgcp_distancesampling.html">LGCPs - Distance sampling</a>
    </li>
    <li>
      <a href="../../articles/web/2d_lgcp_multilikelihood.html">LGCPs - Multiple Likelihoods</a>
    </li>
    <li>
      <a href="../../articles/web/2d_lgcp_plotsampling.html">LGCPs - Plot sampling</a>
    </li>
    <li>
      <a href="../../articles/web/2d_lgcp_spatiotemporal.html">LGCPs - An example in space and time</a>
    </li>
    <li>
      <a href="../../articles/web/publications.html">Publications</a>
    </li>
    <li>
      <a href="../../articles/web/random_fields.html">Random Fields in One Dimension</a>
    </li>
    <li>
      <a href="../../articles/web/random_fields_2d.html">Random Fields in 2D</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/inlabru-org/inlabru/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="1d_lgcp_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>LGCPs - An example in one dimension</h1>
                        <h4 class="author">David Borchers and Finn Lindgren</h4>
            
            <h4 class="date">2021-03-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/inlabru-org/inlabru/blob/master/vignettes/web/1d_lgcp.Rmd"><code>vignettes/web/1d_lgcp.Rmd</code></a></small>
      <div class="hidden name"><code>1d_lgcp.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In this vignette we are going to see how to fit an SPDE to one-dimensional <em>point</em> data, i.e. data that consist of the points at which things are located, not the number of points in some area.</p>
</div>
<div id="setting-things-up" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-things-up" class="anchor"></a>Setting things up</h2>
<p>Load libraries</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.inlabru.org">inlabru</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="get-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#get-the-data" class="anchor"></a>Get the data</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Poisson2_1D</span><span class="op">)</span></code></pre></div>
<p>Take a look at the point (and frequency) data</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">pts2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fl">55</span> <span class="op">/</span> <span class="fl">20</span>, boundary <span class="op">=</span> <span class="fl">0</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">0</span>, pch <span class="op">=</span> <span class="st">"|"</span>, cex <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="1d_lgcp_files/figure-html/unnamed-chunk-4-1.png" width="960"></p>
</div>
<div id="fiting-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fiting-the-model" class="anchor"></a>Fiting the model</h2>
<p>Build a 1D mesh:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">55</span>, length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="va">mesh1D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.1d.html">inla.mesh.1d</a></span><span class="op">(</span><span class="va">x</span>, boundary <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code></pre></div>
<p>Make a 1D SPDE model:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">matern</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde2.pcmatern.html">inla.spde2.pcmatern</a></span><span class="op">(</span><span class="va">mesh1D</span>, prior.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">0.75</span><span class="op">)</span>, prior.sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>
<span class="va">mdl</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">~</span> <span class="fu">spde1D</span><span class="op">(</span><span class="va">x</span>, model <span class="op">=</span> <span class="va">matern</span><span class="op">)</span> <span class="op">+</span> <span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Here we want to fit to the actual points, and the <code>inlabru</code> function that does this is called <code>lgcp</code> (for ‘Log Gaussian Cox Process’). The <code>ips</code> and <code>domain</code> parameters are optional, one or the other can be used. Here are two ways of doing the same thing:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit.spde</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/lgcp.html">lgcp</a></span><span class="op">(</span><span class="va">mdl</span>, <span class="va">pts2</span>, ips <span class="op">=</span> <span class="fu"><a href="../../reference/ipoints.html">ipoints</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">55</span><span class="op">)</span>, <span class="fl">50</span>, name <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fita.spde</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/lgcp.html">lgcp</a></span><span class="op">(</span><span class="va">mdl</span>, <span class="va">pts2</span>, domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mesh1D</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="spde-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#spde-parameters" class="anchor"></a>SPDE parameters</h2>
<p>We can look at the posterior distributions of the parameters of the SPDE using the function <code>spde.posterior</code>. It returns <code>x</code> and <code>y</code> values for a plot of the posterior PDF in a data frame, which can be printed using the <code>plot</code> function. To see the PDF for the range parameter, for example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">post.range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/spde.posterior.html">spde.posterior</a></span><span class="op">(</span><span class="va">fit.spde</span>, name <span class="op">=</span> <span class="st">"spde1D"</span>, what <span class="op">=</span> <span class="st">"range"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">post.range</span><span class="op">)</span></code></pre></div>
<p><img src="1d_lgcp_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>Look at the help file for <code>spde.posterior</code> and then plot the posterior for the log of the SPDE range parameter, the SPDE variance and/or log of the variance, and for the Matern covariance function. Make sure you understand the difference between what is plotted for the range and variance parameters, and for the covariance function (which involves both these parameters).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">post.log.range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/spde.posterior.html">spde.posterior</a></span><span class="op">(</span><span class="va">fit.spde</span>, name <span class="op">=</span> <span class="st">"spde1D"</span>, what <span class="op">=</span> <span class="st">"log.range"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">post.log.range</span><span class="op">)</span> <span class="co"># SOLUTION</span>
<span class="va">post.variance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/spde.posterior.html">spde.posterior</a></span><span class="op">(</span><span class="va">fit.spde</span>, name <span class="op">=</span> <span class="st">"spde1D"</span>, what <span class="op">=</span> <span class="st">"variance"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">post.variance</span><span class="op">)</span> <span class="co"># SOLUTION</span>
<span class="va">post.log.variance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/spde.posterior.html">spde.posterior</a></span><span class="op">(</span><span class="va">fit.spde</span>, name <span class="op">=</span> <span class="st">"spde1D"</span>, what <span class="op">=</span> <span class="st">"log.variance"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">post.log.variance</span><span class="op">)</span> <span class="co"># SOLUTION</span>
<span class="va">post.matcorr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/spde.posterior.html">spde.posterior</a></span><span class="op">(</span><span class="va">fit.spde</span>, name <span class="op">=</span> <span class="st">"spde1D"</span>, what <span class="op">=</span> <span class="st">"matern.correlation"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">post.matcorr</span><span class="op">)</span> <span class="co"># SOLUTION</span></code></pre></div>
<p>You can get a feel for sensitivity to priors by specifying different priors and looking at the posterior plots.</p>
</div>
<div id="predicting-intensity" class="section level2">
<h2 class="hasAnchor">
<a href="#predicting-intensity" class="anchor"></a>Predicting intensity</h2>
<p>We can also now predict on any scale we want. For example, to predict on the ‘response’ scale (i.e. the intensity function <span class="math inline">\(\lambda(s)\)</span>), we call <code>predict</code> thus:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">55</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># Set up a data frame of explanatory values at which to predict</span>
<span class="va">pred_spde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.spde</span>, <span class="va">predf</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">spde1D</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>while to predict on the linear predictor scale (i.e. that of the log intensity, <span class="math inline">\(\log(\lambda(s))\)</span>), we call <code>predict</code> thus:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_spde_lp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.spde</span>, <span class="va">predf</span>, <span class="op">~</span> <span class="va">spde1D</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span></code></pre></div>
<p>here’s how to plot the prediction and 95% credible interval:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">pred_spde</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pts2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">0</span>, pch <span class="op">=</span> <span class="st">"|"</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Intensity"</span><span class="op">)</span></code></pre></div>
<p><img src="1d_lgcp_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>How does this compare with the underlying intensity function that generated the data? The function <code><a href="../../reference/Poisson2_1D.html">lambda2_1D( )</a></code> in the dataset <code>Poission2_1D</code> calculates the true intensity that was used in simulating these data. In order to plot this, we make a data frame with <code>x</code>- and <code>y</code>-coordinates giving the true intensity function, <span class="math inline">\(\lambda(s)\)</span>. We use lots of <code>x</code>-values to get a nice smooth plot (150 values).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">55</span>, length <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>
<span class="va">true.lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xs</span>, y <span class="op">=</span> <span class="fu"><a href="../../reference/Poisson2_1D.html">lambda2_1D</a></span><span class="op">(</span><span class="va">xs</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Plot the fitted and true intensity functions:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">pred_spde</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pts2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">0</span>, pch <span class="op">=</span> <span class="st">"|"</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">true.lambda</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Intensity"</span><span class="op">)</span></code></pre></div>
</div>
<div id="goodness-of-fit" class="section level2">
<h2 class="hasAnchor">
<a href="#goodness-of-fit" class="anchor"></a>Goodness-of-Fit</h2>
<p>We can look at the goodness-of-fit of the mode using the <code>inlabru</code> function <code><a href="../../reference/bincount.html">bincount( )</a></code>, which plots the 95% credible intervals in a specified set of bins along the <code>x</code>-axis together with the observed count in each bin: The credible intervals are shown as red rectangles, the mean fitted value as a short horizontal blue line, and the observed data as black points:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/bincount.html">bincount</a></span><span class="op">(</span>
  result <span class="op">=</span> <span class="va">fit.spde</span>,
  observations <span class="op">=</span> <span class="va">pts2</span>,
  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">pts2</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
  predictor <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">spde1D</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">bc</span><span class="op">)</span><span class="op">$</span><span class="va">ggp</span></code></pre></div>
<p><img src="1d_lgcp_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</div>
<div id="estimating-abundance" class="section level2">
<h2 class="hasAnchor">
<a href="#estimating-abundance" class="anchor"></a>Estimating Abundance</h2>
<p>Abundance is the integral of the intensity over space. We estimate it by integrating the predicted intensity over <code>x</code>. Integration is done by adding up the intensity at locations <code>x</code> weighted by a particular weight. The locations <code>x</code> and their weights are constructed using the <code>ipoints</code> function</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ips</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/ipoints.html">ipoints</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">55</span><span class="op">)</span>, <span class="fl">100</span>, name <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span><span class="op">(</span><span class="va">ips</span><span class="op">)</span>
<span class="co">#&gt;       x weight</span>
<span class="co">#&gt; 1 0.275   0.55</span>
<span class="co">#&gt; 2 0.825   0.55</span>
<span class="co">#&gt; 3 1.375   0.55</span>
<span class="co">#&gt; 4 1.925   0.55</span>
<span class="co">#&gt; 5 2.475   0.55</span>
<span class="co">#&gt; 6 3.025   0.55</span>
<span class="va">Lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">fit.spde</span>, <span class="va">ips</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">spde1D</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>You can look at the abundance estimate by typing</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Lambda</span>
<span class="co">#&gt;       mean       sd   q0.025  median   q0.975     smin     smax        cv      var</span>
<span class="co">#&gt; 1 131.7482 13.46556 110.1677 129.999 157.9086 107.6517 182.4645 0.1022068 181.3212</span></code></pre></div>
<ul>
<li>
<code>mean</code> is the posterior mean abundance.</li>
<li>
<code>sd</code> is the estimated standard error of the posterior of the abundance.</li>
<li>
<code>cv</code> is its estimated coefficient of variation (stander error divided by mean).</li>
<li>
<code>q0.025</code> and <code>q0.975</code> are the 95% credible interval bounds.</li>
<li>
<code>q0.5</code> is the posterior median abundance</li>
</ul>
<p>But it is not quite that simple! The above posterior for abundance takes account only of the variance due to us not knowing the parameters of the intensity function. It neglects the variance in the number of point locations, given the intensity function. To include this we need to modify <code><a href="https://rdrr.io/pkg/raster/man/predict.html">predict( )</a></code> as follows:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Nest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span>
  <span class="va">fit.spde</span>, <span class="va">ips</span>,
  <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    N <span class="op">=</span> <span class="fl">50</span><span class="op">:</span><span class="fl">250</span>,
    dpois <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">dpois</a></span><span class="op">(</span><span class="fl">50</span><span class="op">:</span><span class="fl">250</span>,
      lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">spde1D</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>This calculates the same statistics as were calculated for <code>Lambda</code>, but for evey value of <code>N</code> from 50 to 250, rather than for the posterior mean <code>N</code> alone:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/headtail.html">head</a></span><span class="op">(</span><span class="va">Nest</span><span class="op">)</span>
<span class="co">#&gt;    N         mean           sd       q0.025       median       q0.975         smin         smax</span>
<span class="co">#&gt; 1 50 7.061471e-12 4.235732e-11 2.753238e-21 6.628926e-16 7.610670e-11 5.792924e-22 3.928796e-10</span>
<span class="co">#&gt; 2 51 1.497201e-11 8.888367e-11 8.032235e-21 1.686492e-15 1.635154e-10 1.720021e-21 8.216874e-10</span>
<span class="co">#&gt; 3 52 3.114618e-11 1.829547e-10 2.298320e-20 4.208163e-15 3.445708e-10 5.008833e-21 1.685469e-09</span>
<span class="co">#&gt; 4 53 6.359702e-11 3.695358e-10 6.452481e-20 1.030217e-14 7.124306e-10 1.431089e-20 3.392049e-09</span>
<span class="co">#&gt; 5 54 1.275085e-10 7.326857e-10 1.778033e-19 2.475409e-14 1.445792e-09 4.013092e-20 6.700170e-09</span>
<span class="co">#&gt; 6 55 2.511127e-10 1.426524e-09 4.810597e-19 5.839781e-14 2.880828e-09 1.104899e-19 1.299393e-08</span>
<span class="co">#&gt;         cv          var</span>
<span class="co">#&gt; 1 5.998370 1.794142e-21</span>
<span class="co">#&gt; 2 5.936654 7.900307e-21</span>
<span class="co">#&gt; 3 5.874067 3.347243e-20</span>
<span class="co">#&gt; 4 5.810583 1.365567e-19</span>
<span class="co">#&gt; 5 5.746174 5.368284e-19</span>
<span class="co">#&gt; 6 5.680811 2.034970e-18</span></code></pre></div>
<p>We compute the 95% prediction interval and the median as follows</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/marginal.html">inla.qmarginal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>, marginal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Nest</span><span class="op">$</span><span class="va">N</span>, y <span class="op">=</span> <span class="va">Nest</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 100.9189 129.4514 160.1814</span></code></pre></div>
<p>Compare <code>Lambda</code> to <code>Nest</code> by plotting: First calculate the posterior conditional on the mean of <code>Lambda</code></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Nest</span><span class="op">$</span><span class="va">plugin_estimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">dpois</a></span><span class="op">(</span><span class="va">Nest</span><span class="op">$</span><span class="va">N</span>, lambda <span class="op">=</span> <span class="va">Lambda</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span></code></pre></div>
<p>Then plot it and the unconditional posterior</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Nest</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">N</span>, y <span class="op">=</span> <span class="va">mean</span>, colour <span class="op">=</span> <span class="st">"Posterior"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">N</span>, y <span class="op">=</span> <span class="va">plugin_estimate</span>, colour <span class="op">=</span> <span class="st">"Plugin"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="1d_lgcp_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>Do the differences make sense to you?</p>
</div>
<div id="comparison-to-gam-fit" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-to-gam-fit" class="anchor"></a>Comparison to GAM fit</h2>
<p>Now refit a GAM for the count data of <code>Poisson2_1D</code> and plot the estimated intensity function from this GAM fit, together with the LGCP fitted above and the true intensity.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cd2</span> <span class="op">&lt;-</span> <span class="va">countdata2</span>
<span class="va">fit2.gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x</span>, k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">exposure</span><span class="op">)</span><span class="op">)</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">cd2</span><span class="op">)</span>
<span class="va">dat4pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">55</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, exposure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">cd2</span><span class="op">$</span><span class="va">exposure</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>
<span class="va">pred2.gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">fit2.gam</span>, newdata <span class="op">=</span> <span class="va">dat4pred</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="va">dat4pred2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">dat4pred</span>, gam <span class="op">=</span> <span class="va">pred2.gam</span><span class="op">)</span> <span class="co"># SOLUTION</span></code></pre></div>
<p>You should get a plot like this (thick line is the true intensity, the thin solid line the inlabru fit, the dashed line the GAM fit:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">pred_spde</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pts2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">0</span>, pch <span class="op">=</span> <span class="st">"|"</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat4pred2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">gam</span> <span class="op">/</span> <span class="va">exposure</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">true.lambda</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cd2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">count</span> <span class="op">/</span> <span class="va">exposure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Intensity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span> <span class="co"># SOLUTION</span></code></pre></div>
<p><img src="1d_lgcp_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Finn Lindgren, Fabian E. Bachl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
