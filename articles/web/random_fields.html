<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Random Fields in One Dimension • inlabru</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Random Fields in One Dimension">
<meta property="og:description" content="inlabru">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">inlabru</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.3.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/linearapprox.html">Nonlinear model approximation</a>
    </li>
    <li>
      <a href="../../articles/method.html">Iterative INLA method</a>
    </li>
    <li>
      <a href="../../articles/web/1d_lgcp.html">LGCPs - An example in one dimension</a>
    </li>
    <li>
      <a href="../../articles/web/2d_lgcp.html">LGCPs - An example in two dimensions</a>
    </li>
    <li>
      <a href="../../articles/web/2d_lgcp_covars.html">LGCPs - Spatial covariates</a>
    </li>
    <li>
      <a href="../../articles/web/2d_lgcp_distancesampling.html">LGCPs - Distance sampling</a>
    </li>
    <li>
      <a href="../../articles/web/2d_lgcp_multilikelihood.html">LGCPs - Multiple Likelihoods</a>
    </li>
    <li>
      <a href="../../articles/web/2d_lgcp_plotsampling.html">LGCPs - Plot sampling</a>
    </li>
    <li>
      <a href="../../articles/web/2d_lgcp_spatiotemporal.html">LGCPs - An example in space and time</a>
    </li>
    <li>
      <a href="../../articles/web/publications.html">Publications</a>
    </li>
    <li>
      <a href="../../articles/web/random_fields.html">Random Fields in One Dimension</a>
    </li>
    <li>
      <a href="../../articles/web/random_fields_2d.html">Random Fields in 2D</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/inlabru-org/inlabru/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="random_fields_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Random Fields in One Dimension</h1>
                        <h4 class="author">Finn Lindgren</h4>
            
            <h4 class="date">2021-04-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/inlabru-org/inlabru/blob/master/vignettes/web/random_fields.Rmd"><code>vignettes/web/random_fields.Rmd</code></a></small>
      <div class="hidden name"><code>random_fields.Rmd</code></div>

    </div>

    
    
<div id="setting-things-up" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-things-up" class="anchor"></a>Setting things up</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.inlabru.org">inlabru</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></code></pre></div>
<p>Make a shortcut to a nicer colour scale:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colsc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>
    colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">11</span>, <span class="st">"RdYlBu"</span><span class="op">)</span><span class="op">)</span>,
    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">...</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="get-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#get-the-data" class="anchor"></a>Get the data</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Poisson2_1D</span><span class="op">)</span></code></pre></div>
<p>Put the count data in <code>cd</code> (just because ‘<code>cd</code>’ is less to type than ‘<code>countdata2</code>’.)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cd</span> <span class="op">&lt;-</span> <span class="va">countdata2</span></code></pre></div>
<p>Take a look at the count data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cd</span>
<span class="co">#&gt;            x count exposure</span>
<span class="co">#&gt; 1   2.319888     9 4.639776</span>
<span class="co">#&gt; 2   6.959664    13 4.639776</span>
<span class="co">#&gt; 3  11.599439    11 4.639776</span>
<span class="co">#&gt; 4  16.239215    22 4.639776</span>
<span class="co">#&gt; 5  20.878991    20 4.639776</span>
<span class="co">#&gt; 6  25.518766    19 4.639776</span>
<span class="co">#&gt; 7  30.158542    16 4.639776</span>
<span class="co">#&gt; 8  34.798318     8 4.639776</span>
<span class="co">#&gt; 9  39.438093     4 4.639776</span>
<span class="co">#&gt; 10 44.077869     4 4.639776</span>
<span class="co">#&gt; 11 48.717645     4 4.639776</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cd</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">cd</span><span class="op">$</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="random_fields_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p><em>Tip</em>: <code>RStudio &gt; Help &gt; Cheatsheets &gt; Data visualisation with ggplot2</code> is a useful reference for <code>ggplot2</code> syntax.</p>
</div>
<div id="fitting-a-generalised-additive-model-gam" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-a-generalised-additive-model-gam" class="anchor"></a>Fitting a Generalised Additive Model (GAM)</h2>
<p>If you’re not familiar with GAMs and the syntax of <code>gam</code> don’t worry, the point of this is just to provide something to which we can compare the <code>inlabru</code> model fit.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit2.gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x</span>, k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">exposure</span><span class="op">)</span><span class="op">)</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">cd</span><span class="op">)</span></code></pre></div>
<p>The term <code><a href="https://rdrr.io/pkg/mgcv/man/s.html">s(x,k=10)</a></code> just specifies that as nonparametric smooth function is to be fitted to the data, with <em>no more than</em> 10 degrees of freedom (df). (The larger the df, the more wiggly the fitted curve (recall from the lecture that this is an effect of how some spline methods are defined, without discretisation dependent penalty); <code>gam</code> selects the ‘best’ df.) Notice the use of <code>offset=</code>. (Refer to slides for an explanation of <code>offset</code>.) The variable <code>exposure</code> in data frame <code>cd</code> is the size of the bin in which each count was made.</p>
<p>You can look at the fitted model using <code><a href="https://rdrr.io/r/base/summary.html">summary( )</a></code> as below if you want to, but you do not need to understand this output, or the code that makes the predictions immediately below it if you are not familiar with GAMs.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit2.gam</span><span class="op">)</span></code></pre></div>
<p>Make a prediction data frame, get predictions and add them to the data frame First make vectors of x-values and associated (equal) exposures:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">55</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="va">exposures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">cd</span><span class="op">$</span><span class="va">exposure</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">100</span><span class="op">)</span></code></pre></div>
<p>and put them in a data frame:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat4pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xs</span>, exposure <span class="op">=</span> <span class="va">exposures</span><span class="op">)</span></code></pre></div>
<p>Then predict</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred2.gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">fit2.gam</span>, newdata <span class="op">=</span> <span class="va">dat4pred</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="va">dat4pred2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">dat4pred</span>, gam <span class="op">=</span> <span class="va">pred2.gam</span><span class="op">)</span> <span class="co"># add column for prediction in data frame</span></code></pre></div>
<p>Ploting the fit and the data using the <code>ggplot2</code> commands below should give you the plot shown below</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat4pred2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">gam</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dat4pred2</span><span class="op">$</span><span class="va">gam</span>, <span class="va">cd</span><span class="op">$</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">count</span><span class="op">)</span>, <span class="va">cd</span><span class="op">)</span></code></pre></div>
<p><img src="random_fields_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</div>
<div id="fitting-an-spde-model-with-inlabru" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-an-spde-model-with-inlabru" class="anchor"></a>Fitting an SPDE model with inlabru</h2>
<p>Make mesh.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">55</span>, length <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="co"># this sets mesh points - try others if you like</span>
<span class="va">mesh1D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.mesh.1d.html">inla.mesh.1d</a></span><span class="op">(</span><span class="va">x</span>, boundary <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></code></pre></div>
<p>… and see where the mesh points are:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">mesh1D</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">55</span><span class="op">)</span></code></pre></div>
<div id="using-function-bru-to-fit-to-count-data" class="section level3">
<h3 class="hasAnchor">
<a href="#using-function-bru-to-fit-to-count-data" class="anchor"></a>Using function <code>bru( )</code> to fit to count data</h3>
<p>We need to specify model components and a model formula in order to fit it. This can be done inside the call to <code><a href="../../reference/bru.html">bru( )</a></code> but that is a bit messy, so we’ll store it in <code>comp</code> first and then pass that to <code><a href="../../reference/bru.html">bru( )</a></code>.</p>
<p>Our response variable in the data frame <code>cd</code> is called <code>count</code> so the model specification needs to have that on the left of the <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>. We add an intercept component with <code>+ Intercept(1)</code> on the right hand side (all the models we use have intercepts), and because we want to fit a Gaussian random field (GRF), it must have a GRF specification. In <code>inlabru</code> the GRF specification is a function, which allows the GRF to be calculated at any point in space while <code>inlabru</code> is doing its calculations.</p>
<p>The user gets to name the GRF function. The syntax is ‘myname(input, model= …)’, where:</p>
<ul>
<li>‘myname’ is whatever you want to call the GRF (we called it <code>field</code> below);</li>
<li>
<code>input</code> specifies the coordinates in which the GRF or SPDE ‘lives’. Here we are working in one dimension, and we called that dimension <code>x</code> when we set up the data set.</li>
<li>
<code>model=</code> designates the type of effect, here an SPDE model object from the <code>INLA</code> function <code><a href="https://rdrr.io/pkg/INLA/man/inla.spde2.pcmatern.html">inla.spde2.pcmatern( )</a></code>, which requires a mesh to be passed to it, so we pass it the 1D mesh that we created above, `<code>mesh1D</code>.</li>
</ul>
<p>For models that only adds the model components, we don’t need to specify a separate predictor formula. Instead, we can provide the name of the output to the left of the <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code> in the component specification.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">the_spde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.spde2.pcmatern.html">inla.spde2.pcmatern</a></span><span class="op">(</span><span class="va">mesh1D</span>,
  prior.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span>,
  prior.sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">0.01</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">comp</span> <span class="op">&lt;-</span> <span class="va">count</span> <span class="op">~</span> <span class="fu">field</span><span class="op">(</span><span class="va">x</span>, model <span class="op">=</span> <span class="va">the_spde</span><span class="op">)</span> <span class="op">+</span> <span class="fu">Intercept</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="va">fit2.bru</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/bru.html">bru</a></span><span class="op">(</span><span class="va">comp</span>, <span class="va">cd</span>, family <span class="op">=</span> <span class="st">"poisson"</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>E <span class="op">=</span> <span class="va">cd</span><span class="op">$</span><span class="va">exposure</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit2.bru</span><span class="op">)</span>
<span class="co">#&gt; inlabru version: 2.3.1.9000</span>
<span class="co">#&gt; INLA version: 21.04.22-1</span>
<span class="co">#&gt; Components:</span>
<span class="co">#&gt;   field: Model types main='spde', group='exchangeable', replicate='iid'</span>
<span class="co">#&gt;   Intercept: Model types main='linear', group='exchangeable', replicate='iid'</span>
<span class="co">#&gt; Likelihoods:</span>
<span class="co">#&gt;   Family: 'poisson'</span>
<span class="co">#&gt;     Data class: 'data.frame'</span>
<span class="co">#&gt;     Predictor: count ~ .</span>
<span class="co">#&gt; Time used:</span>
<span class="co">#&gt;     Pre = 1.4, Running = 0.248, Post = 0.117, Total = 1.77 </span>
<span class="co">#&gt; Fixed effects:</span>
<span class="co">#&gt;            mean    sd 0.025quant 0.5quant 0.975quant  mode   kld</span>
<span class="co">#&gt; Intercept 5.677 6.684     -0.101    2.097     22.755 1.376 0.003</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random effects:</span>
<span class="co">#&gt;   Name     Model</span>
<span class="co">#&gt;     field SPDE2 model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model hyperparameters:</span>
<span class="co">#&gt;                   mean     sd 0.025quant 0.5quant 0.975quant   mode</span>
<span class="co">#&gt; Range for field 45.767 38.999      5.862   35.186     152.22 16.990</span>
<span class="co">#&gt; Stdev for field  0.593  0.318      0.224    0.513       1.43  0.398</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Expected number of effective parameters(stdev): 4.26(1.44)</span>
<span class="co">#&gt; Number of equivalent replicates : 2.58 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Information Criterion (DIC) ...............: 59.64</span>
<span class="co">#&gt; Deviance Information Criterion (DIC, saturated) ....: 76.28</span>
<span class="co">#&gt; Effective number of parameters .....................: 4.79</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Watanabe-Akaike information criterion (WAIC) ...: 58.07</span>
<span class="co">#&gt; Effective number of parameters .................: 2.57</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Marginal log-Likelihood:  -38.84 </span>
<span class="co">#&gt; Posterior marginals for the linear predictor and</span>
<span class="co">#&gt;  the fitted values are computed</span></code></pre></div>
<p>Predict the values at the x points used for mesh (the data argument must be a data frame, see <code><a href="../../reference/predict.bru.html">?predict.bru</a></code>):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x4pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xs</span><span class="op">)</span>
<span class="va">pred2.bru</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">fit2.bru</span>, <span class="va">x4pred</span>, <span class="va">x</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">field</span> <span class="op">+</span> <span class="va">Intercept</span><span class="op">)</span>, n.samples <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></code></pre></div>
<p>Let’s do a plot to compare the fitted model to the true model. The expected counts of the true model are stored in the variable <code>E_nc2</code> which comes with the dataset <code>Poisson2_1D</code>. For ease of use in plotting with <code>ggplot2</code> (which needs a data frame), we create a data frame which we call <code>true.lambda</code>, containing <code>x</code>- and <code>y</code> variables as shown below.</p>
<p>Given that <code>inlabru</code> predictions are always on the intensity function scale, do you understand why we divide the count by <code>cd$exposure</code>? (We will in due course allow predictions on the count scale as well.)</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">true.lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cd</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">E_nc2</span> <span class="op">/</span> <span class="va">cd</span><span class="op">$</span><span class="va">exposure</span><span class="op">)</span></code></pre></div>
<p>These <code>ggplot2</code> commands should generate the plot shown below. It shows the true intensities as short horizontal blue lines, the observed intensities as black dots, and the fitted intensity function as a red curve, with 95% credible intervals shown as a light red band about the curve.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">pred2.bru</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cd</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">count</span> <span class="op">/</span> <span class="va">cd</span><span class="op">$</span><span class="va">exposure</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">true.lambda</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, pch <span class="op">=</span> <span class="st">"_"</span>, cex <span class="op">=</span> <span class="fl">9</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Intensity"</span><span class="op">)</span>
<span class="co">#&gt; Warning: Use of `cd$exposure` is discouraged. Use `exposure` instead.</span></code></pre></div>
<p><img src="random_fields_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<p>Compare the <code>inlabru</code> fit to the <code>gam</code> fit:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../../reference/gg.html">gg</a></span><span class="op">(</span><span class="va">pred2.bru</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cd</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">count</span> <span class="op">/</span> <span class="va">exposure</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat4pred2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">gam</span> <span class="op">/</span> <span class="va">exposure</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Intensity"</span><span class="op">)</span></code></pre></div>
</div>
<div id="looking-at-the-posterior-distributions" class="section level3">
<h3 class="hasAnchor">
<a href="#looking-at-the-posterior-distributions" class="anchor"></a>Looking at the posterior distributions</h3>
<p>We can look at the Intercept posterior using the function <code><a href="https://rdrr.io/pkg/raster/man/plot.html">plot( )</a></code>, as below.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">fit2.bru</span>, <span class="st">"Intercept"</span><span class="op">)</span></code></pre></div>
<p><img src="random_fields_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
<p>You have to know that there is a variable called <code>Intercept</code> in order to use this function. To see what fixed effect parameters’ posterior distributions are available to be plotted, you can type</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">fit2.bru</span><span class="op">$</span><span class="va">marginals.fixed</span><span class="op">)</span></code></pre></div>
<p>This does not tell you about the SPDE parameters, and if you type</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">fit2.bru</span><span class="op">$</span><span class="va">marginals.random</span><span class="op">)</span>
<span class="co">#&gt; [1] "field"</span></code></pre></div>
<p>this just tells you that there is an SPDE in fit2.bru called ‘field’, it does not tell you what the associated parameter names are. The parameters that are used in estimation are cryptic – what we are interested in is the range and variance of the Matern covariance funcion, that are functions of the internal parameters. We can look at the posterior distributions of the range parameter and the log of the variance parameters as follows. (We look at the posterior of the <em>log</em> of the variance because the variance posterior is very skewed and so it is easier to view the log of the variance)</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spde.range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/spde.posterior.html">spde.posterior</a></span><span class="op">(</span><span class="va">fit2.bru</span>, <span class="st">"field"</span>, what <span class="op">=</span> <span class="st">"range"</span><span class="op">)</span>
<span class="va">spde.logvar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/spde.posterior.html">spde.posterior</a></span><span class="op">(</span><span class="va">fit2.bru</span>, <span class="st">"field"</span>, what <span class="op">=</span> <span class="st">"log.variance"</span><span class="op">)</span>

<span class="va">range.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">spde.range</span><span class="op">)</span>
<span class="va">var.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">spde.logvar</span><span class="op">)</span>
<span class="fu"><a href="../../reference/multiplot.html">multiplot</a></span><span class="op">(</span><span class="va">range.plot</span>, <span class="va">var.plot</span><span class="op">)</span></code></pre></div>
<p><img src="random_fields_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>We can look at the posterior distributions of the Matern correlatioin and covariance funcitons as follows:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/spde.posterior.html">spde.posterior</a></span><span class="op">(</span><span class="va">fit2.bru</span>, <span class="st">"field"</span>, what <span class="op">=</span> <span class="st">"matern.correlation"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="random_fields_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../../reference/spde.posterior.html">spde.posterior</a></span><span class="op">(</span><span class="va">fit2.bru</span>, <span class="st">"field"</span>, what <span class="op">=</span> <span class="st">"matern.covariance"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="random_fields_files/figure-html/unnamed-chunk-23-2.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Finn Lindgren, Fabian E. Bachl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
